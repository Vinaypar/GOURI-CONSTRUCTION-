(window.msfast_searchux_sb_jsonp=window.msfast_searchux_sb_jsonp||[]).push([["cpl-answerproviderhost~cpl-exit~cpl-host~cpl-invoker~cpl-no-submit~pp-comp~stream"],{NQus:function(e,t,r){"use strict";function a(e){var t=0,r=(e||"").trim().replace(/\s+/," ");return r&&(t=r.length),{characterCount:t,wordCount:0,wordLengths:[]}}r.d(t,"a",(function(){return a}))},zH9T:function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var a=r("+zb2"),i=r("CVAo"),n=r("anwg"),o=r("nwXE"),s=r("Ak5F");var c=r("+du+");r("lonS"),r("kCs8"),r("3dW/");function d(e){return e&&Object(c.a)(e,(function(e){return"string"==typeof e||"number"==typeof e?e:JSON.stringify(e)}))}r("25hB");var u=r("ohlq");function l(e){var t={LogicalId:e.logicalSearchId,ConversationId:e.conversationId,TraceId:e.traceId,Version:o.a.current,LocalTime:Object(n.a)(e.localTimeOverride||new Date),ImpressionType:e.impressionType,ScenarioName:e.scenarioName,ProviderName:e.providerName,Results:e.dataSourceEntities,Part:e.part||0};Object(s.a)({eventType:"USAGE",name:"ClientDataSource",properties:Object(a.__assign)({},d(t))})}var p=r("W4Bk");function h(e){if(function(e){return Array.isArray(e)}(e)&&function(e){return e.some((function(e){return"AnswerBlock"===e.Name}))&&e.some((function(e){return"RelatedEntities"===e.Name}))}(e)){var t=e.find((function(e){return"AnswerBlock"===e.Name})),r=e.find((function(e){return"RelatedEntities"===e.Name}));t.ResultsView.push(r),e=[t]}return e}function m(e){var t=e.logicalSearchId,r=e.conversationId,i=e.layoutType,c=e.resultsView,u=e.nameDetail,l=e.part,m=e.verticalType,I=e.pageNumber,v=e.metadata,y=function(e){var t=e.logicalSearchId,r=void 0===t?Object(p.a)():t,a=e.conversationId,i=e.layoutType,s=e.resultsView,c=e.part,d=e.verticalType,u=e.pageNumber,l=e.metadata;return{LogicalId:r,ConversationId:a,Version:o.a.current,LocalTime:Object(n.a)(new Date),LayoutType:i,Part:c,ResultsView:s,VerticalType:d,PageNumber:u,metadata:l}}({logicalSearchId:t,conversationId:r,layoutType:i,resultsView:h(c),part:l,verticalType:m,pageNumber:I,metadata:v});Object(s.a)({eventType:"USAGE",name:"ClientLayout",properties:Object(a.__assign)(Object(a.__assign)({},d(y)),{nameDetail:u})})}function I(e){var t=e.logicalSearchId,r=e.conversationId,a=e.traceId,i=e.status,n=e.providerName,c=e.latency,d=e.requestParams,u=e.nameDetail;Object(s.a)({eventType:"USAGE",name:"ResponseReceived",properties:{LogicalId:t,ConversationId:r,Version:o.a.current,TraceId:a,Status:i,ProviderName:n,Latency:c,nameDetail:null!=u?u:n,RequestParams:JSON.stringify(d)}})}var v=r("xo1z"),y=r("D7WJ"),g=r("ZUMI"),T=r("L1IH"),f=r("trM5"),S=void 0,b=["consumer","global","groupscoped","person","scoped"],w=["teamsitesearch","hubsitesearch","commsitesearch"],O=["sphomeweb","officehome","msw"];function j(e,t,r,a,i,n,o,s){return new N(e,t,r,a,i,n,o,s)}var N=function(){function e(e,t,r,a,i,n,o,s){this.fetchStartTime=e,this.searchTextCharacteristics=t,this.logicalSearchId=r,this.conversationId=a,this.items=i,this.instrumenter=n,this.activatedTime=o,this.inputTime=s,this.isDispatched=!1}return e.prototype.dispatch=function(){if(!this.isDispatched){this.isDispatched=!0,S=S&&S.logicalId===this.logicalSearchId?{logicalId:this.logicalSearchId,part:S.part+1}:{logicalId:this.logicalSearchId,part:0};var e={eventType:"USAGE",nameDetail:"Searchbox.Impression",name:"searchbox_impression",properties:{impressionId:this.logicalSearchId,conversationId:this.conversationId,fetchStartTime:Math.round(this.fetchStartTime),activatedTime:this.activatedTime&&Math.round(this.activatedTime),inputTime:this.inputTime&&Math.round(this.inputTime),characterCount:this.searchTextCharacteristics.characterCount,items:JSON.stringify(this.items.map((function(e){return Object(a.__assign)(Object(a.__assign)({},e),{emitTime:Math.round(e.emitTime),delayTime:Math.round(e.delayTime)})})))}};Object(s.a)(e),this.dispatchCachedContentRenderedByLogicalId(),this.dispatchResultsRenderedByTraceId();var t=this.getResultsViewForGroups();m({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,layoutType:"Vertical",resultsView:t,nameDetail:"Searchbox.Impression",part:S.part,metadata:this.createMetadata()}),this.dispatchClientDataSourceAndResponseRecievedByTraceId()}},e.prototype.dispatchClientDataSourceAndResponseRecievedByTraceId=function(){var e,t,r=this,i=Object(v.a)(Object(u.a)())||Object(u.a)();if(0!==this.items.length){var n=Object(g.a)(this.items.filter((function(e){return"External"===e.entityType})),(function(e){return e.traceId}));try{for(var o=Object(a.__values)(Object.keys(n)),s=o.next();!s.done;s=o.next()){var c=s.value,d=n[c],p=d.map((function(e){return{Type:"External"===e.entityType?r.mapGroupIdToEntityType(e.groupId):e.entityType,ReferenceId:e.entityId}})),h=d[0].providerId;l({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,impressionType:"Suggestions",scenarioName:i,providerName:this.mapProviderIdToProviderName(h),dataSourceEntities:p,part:null==S?void 0:S.part,localTimeOverride:new Date((new Date).getTime()-(Object(y.a)()-(this.inputTime||this.fetchStartTime)))});var m=d[0],T=Math.round(m.emitTime-(this.inputTime||this.fetchStartTime));I({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,providerName:h,status:200,latency:T,requestParams:{QueryLength:this.searchTextCharacteristics.characterCount}})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}else this.dispatchEmptySuggestionInformation(i)},e.prototype.getResultsViewForGroups=function(){var e=this,t=Object(g.a)(this.items,(function(e){return e.groupId})),r=Object(T.a)(t,(function(t,r){return Object(a.__assign)({Position:t[0].pos,ProviderId:t[0].traceId,Type:"Group",Name:e.mapGroupIdToGroupName(r),ReferenceId:Object(i.a)(),PlacementType:"Visible",LayoutType:"Vertical",ResultsView:e.getResultsViewForSuggestions(t),EntityCount:t.length},"answer"===(null==r?void 0:r.toLowerCase())&&{EntityType:e.mapGroupIdToEntityType(r)})}));return Object(f.a)(r,(function(e){return e.Position})).map((function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{Position:t+1})}))},e.prototype.getResultsViewForSuggestions=function(e){var t=this;return e.map((function(e,r){var a="External"===e.entityType||"Fact"===e.entityType?t.mapGroupIdToEntityType(e.groupId):e.entityType;return{Position:r+1,ProviderId:e.traceId,Type:"Entity",EntityType:a,ReferenceId:e.entityId,PlacementType:"Visible"}}))},e.prototype.mapGroupIdToGroupName=function(e){switch(null==e?void 0:e.toLowerCase()){case"peoplepill":return"person";case"bestmatch":return"TopHits";case"vroomfiles":return"file";case"vroomsites":return"site";case"vroomnews":return"news";case"answer":return"AnswerBlock";case"peopleanswer":return"RelatedEntities";default:return e}},e.prototype.mapGroupIdToEntityType=function(e){switch(null==e?void 0:e.toLowerCase()){case"vroomfiles":case"file":return"File";case"vroomsites":case"site":return"Site";case"vroomnews":case"news":return"News";case"app":return"App";case"person":case"peoplepill":case"answer":return"People";case"bookmark":return"Bookmark";case"querysuggestion":case"querysuggestionprovider":return"TextualSuggestion";case"peopleanswer":return"People";case"peopleanswerfiles":return"RelatedEntities";default:return"External"}},e.prototype.mapProviderIdToProviderName=function(e){switch(null==e?void 0:e.toLowerCase()){case"querysuggestionprovider":return"SpoTenantTrendingQueriesProvider";default:return e}},e.prototype.dispatchCachedContentRenderedByLogicalId=function(){var e,t,r,i=Object(g.a)(this.items,(function(e){return e.fromCache})).true,c=Object(g.a)(i,(function(e){return e.originalLogicalSearchId}));try{for(var d=Object(a.__values)(Object.keys(c)),u=d.next();!u.done;u=d.next()){var l=u.value;r={logicalSearchId:this.logicalSearchId,originalLogicalSearchId:l,conversationId:this.conversationId,localTimeOverride:new Date((new Date).getTime()-(Object(y.a)()-(this.inputTime||this.fetchStartTime)))},Object(s.a)({eventType:"USAGE",name:"CachedContentRendered",properties:{nameDetail:r.nameDetail,LogicalId:r.originalLogicalSearchId,NewLogicalId:r.logicalSearchId,ConversationId:r.conversationId,Version:o.a.current,LocalTime:Object(n.a)(r.localTimeOverride||new Date)}})}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=d.return)&&t.call(d)}finally{if(e)throw e.error}}},e.prototype.dispatchResultsRenderedByTraceId=function(){var e,t,r,i=Object(g.a)(this.items,(function(e){return e.traceId}));try{for(var n=Object(a.__values)(Object.keys(i)),c=n.next();!c.done;c=n.next()){var d=c.value,u=i[d][0];r={logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:d,latency:Math.round(u.emitTime-(this.inputTime||this.fetchStartTime))},Object(s.a)({eventType:"USAGE",name:"ResultsRendered",properties:Object(a.__assign)(Object(a.__assign)({E2ELatency:r.latency},r.renderLatency),{LogicalId:r.logicalSearchId,ConversationId:r.conversationId,TraceId:r.traceId,Version:o.a.current,ProviderName:r.providerName,VerticalName:r.verticalName,VerticalId:r.verticalId,properties:JSON.stringify(r.properties),measures:JSON.stringify(r.measures),NavScenario:r.NavScenario,TabInBackground:r.isTabInBackground})})}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.dispatchEmptySuggestionInformation=function(e){var t=Object(i.a)(),r=Object(y.a)()-(this.inputTime||this.fetchStartTime);I({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:t,providerName:"EmptySuggestions",status:200,latency:r,requestParams:{QueryLength:this.searchTextCharacteristics.characterCount}}),l({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:t,impressionType:"Suggestions",scenarioName:e,providerName:"EmptySuggestions",dataSourceEntities:[],part:null==S?void 0:S.part,localTimeOverride:new Date((new Date).getTime()-(Object(y.a)()-(this.inputTime||this.fetchStartTime)))})},e.prototype.createMetadata=function(){if(this.instrumenter){var e={},t=this.instrumenter.props,r=t.spInfo,a=t.hostAppInfo;return r&&(e.WebId=r.webId,e.SiteId=r.siteId),a&&(a.scopeId&&b.indexOf(a.scopeId.toLowerCase())>-1?e.Scopes=a.scopeId:a.id&&(w.indexOf(a.id.toLowerCase())>-1?e.Scopes="scoped":O.indexOf(a.id.toLowerCase())>-1&&(e.Scopes="global"))),e}},e}()}}]);